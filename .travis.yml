dist: xenial
language: bash
branches:
  only:
  - main
  - "/^v\\d+\\.\\d+(\\.\\d+)?(-\\S*)?$/"
env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - PATH=$PATH:${HOME}/google-cloud-sdk/bin
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - HELM_VERSION=v3.5.4
  - RESERVED_IP_NAME=demo-static-ip
  - REGION=us-central1
  - GKE_CLUSTER=nginx-tutorial-2
  - secure: XweKaD2vJpnsdnot521YmmKivye3E3JQhhikAMNQcKLfjx8L+f1gBWEQjjUk7sg6Sx3+6DaHdbHnrG3VGvjvbJPd5RUblxtLVHAApxwJGoMjdBHPpI/uaGQd2j+h56v8SDfO84NfMsJLoWVgpXvSVag153qrZRzbG8h7wP7et6MwcjkauIMw2oP0ZA5tnTrdCBwzBh5Xb9FQFcqHSj0ExWvdJocBV7sMbQdxAKrLicM94xrDLe6/NEBMuyLYD6nJl5L/GD/GBU8QLtHiqtuHEcjI2niH3v+LE6hnZFYhXB0Y2e///nUwDZsfx+LFvdL2TkUxUMYU4ecRHOHufxnUUlPbM5TcsseB86N8qo3tzyXtmxXJXGYdHbaC6txSNV5rtMs6wkjVGCIejBH6cN6EN+NUpDLhOkOfMbb+da7VNVPXSnZZsXfT5TInJo9T493sZLYWPM5pq7kNqC4c2MDrZEOwGrj37Y7wMQfngZKGVDXLle1uoDoQ65+IJ0eiyPYeAO8pfg4bDMEwlLOk+jHZoWBsd8ae9btlQmKrrkaKo4YiBlVGpDN8IucfVDiPONToPgcBa4m6T5yG5gjHREIqSAzANGc1EDajh6JHQdEbL1BfZBI7m7cKlqnfRBIc5ymPh1o6SCE4iPl6qx2Wae1nq6hEoVBjDgHMzYpJuyXDR4M=
  - secure: F3KlF6l1nqGGz7UhAzLKk+S1no6wNF0/hswuO93j7JGWPU8dgqPnXnObt0ADOesOLgkXP4NXpRzE30SA2F37iBxF9x9YXMiDCR3fBlNj7CRRiAy/LIhlntNGSrYAkFIuq4ASHhSbOtt0bPvw9OJ3CLu5hB7DNhvM3Sd9Ge9U+AcSwTSdVVjh51fZEwKIfEAXtkCaSxnL867HfuzT/DwkPtYk3HboKiFf+U67wITcBtoKEZtGK3m9I4/sqQNjrXE66Z44WpaZ8aSDDu4VEsZ4XsKZkHcMx4H5hMM3PfAPDXkzM/9l1uIDGl2CblSNo62Rj4K3YUEaLGln3aH+JfrEvrVoFMRMLroAm5PToG3yLE1ctwhOj/WVu2s0EA7nZlg3Y3tGBXCFreDl+MEsy3dqmdNukQzXZGBjAXXyP/eoguf+sOGTILas0H/abABg5g0C2Iw4T8Hsc60Bp6h0X3MWZ2n/SLD+eT/b4xdzuSVARWvY/P0aiBGNjOtS86W58GT/JbEk006kX5v6MM6O6StGXLk38ojzy+8yWhsUrK9KWY6AZ5hmnyG13o2aZQWsZ02D3k09zdiwBS7z9f1/XD+m+S7R6N+mUCy4pkuHOJa7DcvY9IJrZjg6P/cNAtVfE+TNB95DZToLjq+MDWANw5Tl+tCKHT+ER83VrzsZU/qEZYI=
  - secure: l3VOYYDtMDPTaxyrS/Ujc/Wmi/9s09AGMaC7/yJ7HJhQ+25lYrt9rw7RE53C1QtY1xWhBEsgAzt2h+N796pEi5Cs767F+RnjTI44pWtDJlReUyikPu0dJgku+a7m6IYF/TVwByFRP+1at70dq85yoa1GZ414vlcU5dXpcv+UaySJ459snSSy1J7skJmir3WHHd46IlCsfGbiTs5wNT+HaQE7IPAPfpxC11x/K9OhMlI40+3Clu+pqPPkIvcz+H4UKo0BD2jR5UeaSGlEsGwwGFeHq8j4UQ5EAVtnKtScxz1et0n7fJ5uHzXXGhc2stBM2DHihxA1BJFGIr26xG9kB/rtRjz+VtvleENQLl78ygOlTffktaGo8dB56auqLM22yCnkIfqr1PpVOjkPCK6WaT4vbgOhTM6Hd/U1t4KX7JU6UmMGq/nPc48j1O4PA5YsXzrW0O6tj0lbUuMjlg973dTYZHrbmTpb2TLEqWxI0lMRh3lzQNklaYBi/6rkOg9vpfIM28d1LzRgLI3m2mMxSLTUzixyY8pDseC2Q8Bg0LrNpMwcEt8f6bPSusVf4o1VjOd37gR01chRVAhgpNeLCFZhYKgdoHdIil5IIRS2wBVfjXPbqakGTDPAkWG8x70999zcICgcHChp67CLTzRYsA3D+9M2p/giNGLbVX+oWtk=
  #- secure: g8xzFfbU2t/k4Y8b70iRB3bh2GXA4EfUj2LMYQU7yrRUAgt6TRjYa0Kn5iJkpMil9j/GLZk4xb/c05wrU2vhbBv7wgyfrmODUyeNTYD/KaUOvLvuuJ8WWJZm0I9F85SsCYReso1wAXsSmIIFnBtgXhNYQtAm+HH4JBCCEZQzR/kJSRuiK30iqseI3PUew3RFK55PA3NKBSx86BS4RwoO7YHLcumeAYrxLyaRGeem7oAOWNWV2XKdaki0HPsZrTjl2O0cGNpvYVyq4+gwWBKKs4LI7DSRBgwxoIEu3jjSUkR9wOYtiyMtvKnSkLD7RVEiSDBypjkU5jxghozanJ4mjX0rRPMigEL6mYP4nujU52j1fld/QAOy09McfCuaU8aSEsN1wmdf4h3pAgy0Lz4Ay4Kfun6jCRS7Vn4Wu29nf+AuZbVNViorS16Cjjl3H/nai393rqNXYQMWFzc7FJZ5U06DndcETV23ZV5rffcOcAAPZGDJYaEqaMJPpb333pqxm/pBkOLmHk5oavO8+eikwINuQIcKR90EpyNnbvwdYLquZUA9rze8JNGN+ic927a8lt0fiyZPWt1p2tztE+oZbfAng0XYKfqjUokgLNhJVjIhbZXm57cQ3MtHkwG3JVzpqlDMf9X8XK4WEwqOAmafQAeyVvm8Ix4ZV4n8MJUSioY=
  #- secure: oTlPgsA+OdjqlU2lgS55z2vsnHsnJP9pi+lAHvN9br8hj4ZGdzAi/QcrhOWc8GmPdPjYKvZdETVIi1/wBwp6/IIf/6l22VRvRZoYoIpXUJaHdQ6SPC1lf6CwCtKfrrxe72RCKOobwtL0r/LAkU8dBHtGaeWjFGgJNriyVPbvwLRb5Nk1G6qXmlA9rpnRi+IRy61zRj05LJGpOCcNsaK5OFylNZanpY3KkF+Z4tOKediLRxRdZ+85Xf6aA5uiS2zLVtA+UCUp8prGTMAGpwFfGgjyQH+dMVEas3quyJ8G6jm84eoG8UbCE4abFjIzG8ukFrua/bM7t/IKBeBHUIn4aZeuaPucTWCZdfNurJ/lRK9T0r/GaRBxKXbJTPY9DjDW2AelNPo5QwGDxHzxdCTThX691Dhf4P7TVUuYW7utvSwM3Eq21/CIfEnz3w7n7pHYKRENJ9ht2gHrTg7rSRCj3RZqhDnY29YPYeR0a+UG/crP8W6XT0syb7Dvbq0fHpGyMWIMTJnN4eUcj1+cCjIt4qX/3yVl3wr9Y02dLjg5ex6yxzMD49Z5FEda9mFnaMo71Xnl0EqsvkGeUodN9xmQ8Rm2x9DF1pTU9bDSl2UpfleKDSFMTd+xcwuLia6ddD1CH1eYk96b4lnmW8tZ2nc077alxukDI+bx8Ptig6/CXro=
  #- secure: Tza0xbcHiTzD+Zla6y5+QBDr71QFVs4B7rkOA4ILMd17Bh21h5gHlwjgvhRikA3uyvy9LX4KRA4y7vbmmEOaTdHWYa+mhTDuwLc8Yb27XY2ae2ytkgh7aU2WllKMF2HiRV47W6DiSUgAxKm44ggmWt+XWyKQnwyGAazmxzTNBPHnLV3bJmtz8fxY16YBaCXrmhF4rk+/4pMeGxxsT4Q9JVPvy66WK+BlYb+hXwXajJk8IGhcUm/ecXLV+LgxFJGavb3CCa4MTpk7imLC2ZEXBPrC9wyxfDKUbzXpk6xbMm31s+o3wQq+VAD37HcLhdMDOsroBIImCWR+rPW1afwDZCYhIiXOsLba026lt/b2QYnWkrLyQrNIYkBJnpUEbmI1MW8MBallRDcn47EJUy1rEP8O9VfDMbnmhxxKiR8gOEs2lS7aaH3Sk/bHV5E/evLcM/aXmYp+iKrw5IH110cThhZaWoShaOZkQlsRN0q7OJHCRtSJQtsBHSxJJiPIZjATRW7f4mnqaOxoNnBNC+2cBrmiliv6IBtgWKgD+1AnvkuSZXnLkB4+ZwOw8cDYpI1h1/6G+NqrQ7lndQqljfGYaH7gWbYR5sC4ty2Wf8l9c+SBPEZHAWZZMUNUjIEuNmbLZGVZttcwL5cL5WZrKCeQhV8ahIdHG99pbUbpYvYl3Og=
stages:
- merge
before_install:
- openssl aes-256-cbc -K $encrypted_66f446734868_key -iv $encrypted_66f446734868_iv
  -in ci-cd/encrypted/keys.tar.gz.enc -out keys.tar.gz -d
- chmod 764 ci-cd/scripts/deployment.sh
cache:
  yarn: true
  directories:
  - node_modules
jobs:
  include:
  - stage: merge
    if: branch IN (main) AND type = push
    name: Build Container
    script:
    - "./ci-cd/scripts/deployment.sh"
